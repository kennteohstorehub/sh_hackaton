<div class="storehub-container">
  <!-- Header -->
  <div class="storehub-page-header">
    <div class="header-content">
      <h1 class="storehub-page-title"><%= contentTitle %></h1>
      <p class="storehub-page-subtitle"><%= contentSubtitle %></p>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" onclick="refreshSystemStats()">
        <span class="btn-icon">üîÑ</span>
        Refresh Stats
      </button>
    </div>
  </div>

  <div class="settings-layout">
    <!-- Settings Navigation -->
    <div class="settings-nav">
      <div class="card">
        <div class="card-body">
          <h6 class="nav-title">SETTINGS</h6>
          <nav class="nav-pills" id="settingsTab" role="tablist">
            <button class="nav-link active" id="profile-tab" data-bs-toggle="pill" data-bs-target="#profile" type="button" role="tab">
              <span class="nav-icon">üë§</span>
              <span>Profile</span>
            </button>
            <button class="nav-link" id="system-tab" data-bs-toggle="pill" data-bs-target="#system" type="button" role="tab">
              <span class="nav-icon">‚öôÔ∏è</span>
              <span>System Settings</span>
            </button>
            <button class="nav-link" id="security-tab" data-bs-toggle="pill" data-bs-target="#security" type="button" role="tab">
              <span class="nav-icon">üõ°Ô∏è</span>
              <span>Security</span>
            </button>
            <button class="nav-link" id="email-tab" data-bs-toggle="pill" data-bs-target="#email" type="button" role="tab">
              <span class="nav-icon">‚úâÔ∏è</span>
              <span>Email Configuration</span>
            </button>
            <button class="nav-link" id="notifications-tab" data-bs-toggle="pill" data-bs-target="#notifications" type="button" role="tab">
              <span class="nav-icon">üîî</span>
              <span>Notifications</span>
            </button>
            <button class="nav-link" id="stats-tab" data-bs-toggle="pill" data-bs-target="#stats" type="button" role="tab">
              <span class="nav-icon">üìä</span>
              <span>System Stats</span>
            </button>
          </nav>
        </div>
      </div>
    </div>

    <!-- Settings Content -->
    <div class="settings-content">
      <div class="tab-content" id="settingsTabContent">
        <!-- Profile Settings -->
        <div class="tab-pane fade show active" id="profile" role="tabpanel">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">
                <span class="card-icon">üë§</span>
                Profile Settings
              </h3>
            </div>
            <div class="card-body">
              <form method="POST" action="/backoffice/settings/profile" class="storehub-form">
                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                
                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-control" name="name" value="<%= backOfficeUser.fullName %>" required>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" name="email" value="<%= backOfficeUser.email %>" required>
                  </div>
                </div>

                <div class="form-divider"></div>

                <h6 class="form-section-title">
                  <span class="section-icon">üîë</span>
                  Change Password
                </h6>
                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Current Password</label>
                    <input type="password" class="form-control" name="currentPassword" placeholder="Leave blank to keep current">
                  </div>
                  <div class="form-group">
                    <label class="form-label">New Password</label>
                    <input type="password" class="form-control" name="newPassword" placeholder="Minimum 8 characters">
                  </div>
                  <div class="form-group">
                    <label class="form-label">Confirm New Password</label>
                    <input type="password" class="form-control" name="confirmPassword" placeholder="Confirm new password">
                  </div>
                </div>

                <div class="info-card">
                  <div class="info-icon">‚ÑπÔ∏è</div>
                  <div class="info-content">
                    <h6>Account Information</h6>
                    <div class="info-item">
                      <span class="info-label">Account Type:</span>
                      <span class="badge badge-primary">BackOffice User</span>
                    </div>
                    <div class="info-item">
                      <span class="info-label">Member since:</span>
                      <span class="info-value"><%= new Date(backOfficeUser.createdAt).toLocaleDateString() %></span>
                    </div>
                    <div class="info-item">
                      <span class="info-label">Last login:</span>
                      <span class="info-value"><%= backOfficeUser.lastLogin ? new Date(backOfficeUser.lastLogin).toLocaleString() : 'Never' %></span>
                    </div>
                  </div>
                </div>

                <button type="submit" class="btn btn-primary">
                  <span class="btn-icon">üíæ</span>
                  Update Profile
                </button>
              </form>
            </div>
          </div>
        </div>

        <!-- System Settings -->
        <div class="tab-pane fade" id="system" role="tabpanel">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">
                <span class="card-icon">‚öôÔ∏è</span>
                System Settings
              </h3>
            </div>
            <div class="card-body">
              <form method="POST" action="/backoffice/settings/general" class="storehub-form">
                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                
                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Site Name</label>
                    <input type="text" class="form-control" name="siteName" value="<%= typeof generalSettings !== 'undefined' && generalSettings.siteName ? generalSettings.siteName : 'QMS BackOffice' %>" required>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Support Email</label>
                    <input type="email" class="form-control" name="supportEmail" value="<%= typeof generalSettings !== 'undefined' && generalSettings.supportEmail ? generalSettings.supportEmail : 'support@storehubqms.com' %>" required>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Timezone</label>
                    <select class="form-control" name="timezone">
                      <option value="Asia/Kuala_Lumpur" <%= typeof generalSettings !== 'undefined' && generalSettings.timezone === 'Asia/Kuala_Lumpur' ? 'selected' : '' %>>Asia/Kuala_Lumpur (GMT+8)</option>
                      <option value="Asia/Singapore" <%= typeof generalSettings !== 'undefined' && generalSettings.timezone === 'Asia/Singapore' ? 'selected' : '' %>>Asia/Singapore (GMT+8)</option>
                      <option value="Asia/Jakarta" <%= typeof generalSettings !== 'undefined' && generalSettings.timezone === 'Asia/Jakarta' ? 'selected' : '' %>>Asia/Jakarta (GMT+7)</option>
                      <option value="Asia/Bangkok" <%= typeof generalSettings !== 'undefined' && generalSettings.timezone === 'Asia/Bangkok' ? 'selected' : '' %>>Asia/Bangkok (GMT+7)</option>
                      <option value="Asia/Manila" <%= typeof generalSettings !== 'undefined' && generalSettings.timezone === 'Asia/Manila' ? 'selected' : '' %>>Asia/Manila (GMT+8)</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Language</label>
                    <select class="form-control" name="language">
                      <option value="en" <%= typeof generalSettings !== 'undefined' && generalSettings.language === 'en' ? 'selected' : '' %>>English</option>
                      <option value="ms" <%= typeof generalSettings !== 'undefined' && generalSettings.language === 'ms' ? 'selected' : '' %>>Bahasa Malaysia</option>
                      <option value="zh" <%= typeof generalSettings !== 'undefined' && generalSettings.language === 'zh' ? 'selected' : '' %>>‰∏≠Êñá</option>
                    </select>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Date Format</label>
                    <select class="form-control" name="dateFormat">
                      <option value="DD/MM/YYYY" <%= typeof generalSettings !== 'undefined' && generalSettings.dateFormat === 'DD/MM/YYYY' ? 'selected' : '' %>>DD/MM/YYYY</option>
                      <option value="MM/DD/YYYY" <%= typeof generalSettings !== 'undefined' && generalSettings.dateFormat === 'MM/DD/YYYY' ? 'selected' : '' %>>MM/DD/YYYY</option>
                      <option value="YYYY-MM-DD" <%= typeof generalSettings !== 'undefined' && generalSettings.dateFormat === 'YYYY-MM-DD' ? 'selected' : '' %>>YYYY-MM-DD</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Time Format</label>
                    <select class="form-control" name="timeFormat">
                      <option value="12h" <%= typeof generalSettings !== 'undefined' && generalSettings.timeFormat === '12h' ? 'selected' : '' %>>12-hour (AM/PM)</option>
                      <option value="24h" <%= typeof generalSettings !== 'undefined' && generalSettings.timeFormat === '24h' ? 'selected' : '' %>>24-hour</option>
                    </select>
                  </div>
                </div>

                <div class="form-check-group">
                  <label class="form-check">
                    <input type="checkbox" class="form-check-input" name="maintenanceMode" id="maintenanceMode" <%= typeof generalSettings !== 'undefined' && generalSettings.maintenanceMode ? 'checked' : '' %>>
                    <span class="form-check-label">Enable maintenance mode</span>
                    <small class="form-text">When enabled, only BackOffice users can access the system</small>
                  </label>
                </div>

                <button type="submit" class="btn btn-primary">
                  <span class="btn-icon">üíæ</span>
                  Update General Settings
                </button>
              </form>
            </div>
          </div>
        </div>

        <!-- Security Settings -->
        <div class="tab-pane fade" id="security" role="tabpanel">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">
                <span class="card-icon">üõ°Ô∏è</span>
                Security Settings
              </h3>
            </div>
            <div class="card-body">
              <form method="POST" action="/backoffice/settings/security" class="storehub-form">
                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                
                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Session Timeout (minutes)</label>
                    <input type="number" class="form-control" name="sessionTimeout" value="<%= typeof securitySettings !== 'undefined' && securitySettings.sessionTimeout ? securitySettings.sessionTimeout : 480 %>" min="15" max="1440">
                    <small class="form-text">15-1440 minutes (24 hours max)</small>
                  </div>
                  <div class="form-group">
                    <label class="form-check">
                      <input type="checkbox" class="form-check-input" name="requireTwoFactor" id="requireTwoFactor" <%= typeof securitySettings !== 'undefined' && securitySettings.requireTwoFactor ? 'checked' : '' %>>
                      <span class="form-check-label">Require Two-Factor Authentication</span>
                    </label>
                  </div>
                </div>

                <h6 class="form-section-title">Password Requirements</h6>
                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Minimum Length</label>
                    <input type="number" class="form-control" name="passwordMinLength" value="<%= typeof securitySettings !== 'undefined' && securitySettings.passwordMinLength ? securitySettings.passwordMinLength : 8 %>" min="6" max="50">
                  </div>
                  <div class="form-group">
                    <label class="form-check">
                      <input type="checkbox" class="form-check-input" name="passwordRequireNumbers" id="passwordRequireNumbers" <%= typeof securitySettings === 'undefined' || securitySettings.passwordRequireNumbers !== false ? 'checked' : '' %>>
                      <span class="form-check-label">Require numbers</span>
                    </label>
                  </div>
                  <div class="form-group">
                    <label class="form-check">
                      <input type="checkbox" class="form-check-input" name="passwordRequireSymbols" id="passwordRequireSymbols" <%= typeof securitySettings !== 'undefined' && securitySettings.passwordRequireSymbols ? 'checked' : '' %>>
                      <span class="form-check-label">Require symbols</span>
                    </label>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Max Login Attempts</label>
                    <input type="number" class="form-control" name="maxLoginAttempts" value="<%= typeof securitySettings !== 'undefined' && securitySettings.maxLoginAttempts ? securitySettings.maxLoginAttempts : 5 %>" min="3" max="20">
                  </div>
                  <div class="form-group">
                    <label class="form-label">Lockout Duration (minutes)</label>
                    <input type="number" class="form-control" name="lockoutDuration" value="<%= typeof securitySettings !== 'undefined' && securitySettings.lockoutDuration ? securitySettings.lockoutDuration : 30 %>" min="5" max="1440">
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">Allowed IP Ranges (optional)</label>
                  <textarea class="form-control" name="allowedIpRanges" rows="3" placeholder="192.168.1.0/24&#10;10.0.0.0/8"><%= typeof securitySettings !== 'undefined' && securitySettings.allowedIpRanges ? securitySettings.allowedIpRanges : '' %></textarea>
                  <small class="form-text">One IP range per line. Leave empty to allow all IPs.</small>
                </div>

                <button type="submit" class="btn btn-primary">
                  <span class="btn-icon">üíæ</span>
                  Update Security Settings
                </button>
              </form>
            </div>
          </div>
        </div>

        <!-- Email Configuration -->
        <div class="tab-pane fade" id="email" role="tabpanel">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">
                <span class="card-icon">‚úâÔ∏è</span>
                Email Configuration
              </h3>
            </div>
            <div class="card-body">
              <form method="POST" action="/backoffice/settings/email" id="emailConfigForm" class="storehub-form">
                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                
                <div class="form-group">
                  <label class="form-label">Email Provider</label>
                  <select class="form-control" name="provider" id="emailProvider" required>
                    <option value="smtp" <%= typeof emailSettings !== 'undefined' && emailSettings.provider === 'smtp' ? 'selected' : '' %>>SMTP</option>
                    <option value="sendgrid" <%= typeof emailSettings !== 'undefined' && emailSettings.provider === 'sendgrid' ? 'selected' : '' %>>SendGrid</option>
                    <option value="ses" <%= typeof emailSettings !== 'undefined' && emailSettings.provider === 'ses' ? 'selected' : '' %>>Amazon SES</option>
                  </select>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label required">From Name</label>
                    <input type="text" class="form-control" name="fromName" value="<%= typeof emailSettings !== 'undefined' && emailSettings.fromName ? emailSettings.fromName : 'QMS BackOffice' %>" required>
                  </div>
                  <div class="form-group">
                    <label class="form-label required">From Email</label>
                    <input type="email" class="form-control" name="fromEmail" value="<%= typeof emailSettings !== 'undefined' && emailSettings.fromEmail ? emailSettings.fromEmail : 'noreply@storehubqms.com' %>" required>
                  </div>
                </div>

                <!-- SMTP Settings -->
                <div id="smtpSettings" class="provider-settings" style="<%= typeof emailSettings === 'undefined' || emailSettings.provider !== 'smtp' ? 'display: none;' : '' %>">
                  <h6 class="form-section-title">SMTP Settings</h6>
                  <div class="form-row">
                    <div class="form-group">
                      <label class="form-label">SMTP Host</label>
                      <input type="text" class="form-control" name="smtpHost" value="<%= typeof emailSettings !== 'undefined' && emailSettings.smtpHost ? emailSettings.smtpHost : '' %>" placeholder="smtp.gmail.com">
                    </div>
                    <div class="form-group">
                      <label class="form-label">SMTP Port</label>
                      <input type="number" class="form-control" name="smtpPort" value="<%= typeof emailSettings !== 'undefined' && emailSettings.smtpPort ? emailSettings.smtpPort : 587 %>" min="1" max="65535">
                    </div>
                  </div>
                  <div class="form-row">
                    <div class="form-group">
                      <label class="form-label">SMTP Username</label>
                      <input type="text" class="form-control" name="smtpUser" value="<%= typeof emailSettings !== 'undefined' && emailSettings.smtpUser ? emailSettings.smtpUser : '' %>">
                    </div>
                    <div class="form-group">
                      <label class="form-label">SMTP Password</label>
                      <input type="password" class="form-control" name="smtpPassword" placeholder="Leave blank to keep current">
                    </div>
                  </div>
                  <div class="form-check-group">
                    <label class="form-check">
                      <input type="checkbox" class="form-check-input" name="smtpSecure" id="smtpSecure" <%= typeof emailSettings !== 'undefined' && emailSettings.smtpSecure ? 'checked' : '' %>>
                      <span class="form-check-label">Use TLS/SSL</span>
                    </label>
                  </div>
                </div>

                <!-- SendGrid Settings -->
                <div id="sendgridSettings" class="provider-settings" style="<%= typeof emailSettings === 'undefined' || emailSettings.provider !== 'sendgrid' ? 'display: none;' : '' %>">
                  <h6 class="form-section-title">SendGrid Settings</h6>
                  <div class="form-group">
                    <label class="form-label">SendGrid API Key</label>
                    <input type="password" class="form-control" name="sendgridApiKey" placeholder="SG.xxxxxxxxxxxxxxxxxxxx">
                    <small class="form-text">Get your API key from <a href="https://app.sendgrid.com/settings/api_keys" target="_blank">SendGrid Dashboard</a></small>
                  </div>
                </div>

                <!-- AWS SES Settings -->
                <div id="sesSettings" class="provider-settings" style="<%= typeof emailSettings === 'undefined' || emailSettings.provider !== 'ses' ? 'display: none;' : '' %>">
                  <h6 class="form-section-title">Amazon SES Settings</h6>
                  <div class="form-row">
                    <div class="form-group">
                      <label class="form-label">AWS Access Key ID</label>
                      <input type="text" class="form-control" name="awsAccessKeyId" value="<%= typeof emailSettings !== 'undefined' && emailSettings.awsAccessKeyId ? emailSettings.awsAccessKeyId : '' %>">
                    </div>
                    <div class="form-group">
                      <label class="form-label">AWS Secret Access Key</label>
                      <input type="password" class="form-control" name="awsSecretAccessKey" placeholder="Leave blank to keep current">
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="form-label">AWS Region</label>
                    <select class="form-control" name="awsRegion">
                      <option value="us-east-1" <%= typeof emailSettings !== 'undefined' && emailSettings.awsRegion === 'us-east-1' ? 'selected' : '' %>>US East (N. Virginia)</option>
                      <option value="us-west-2" <%= typeof emailSettings !== 'undefined' && emailSettings.awsRegion === 'us-west-2' ? 'selected' : '' %>>US West (Oregon)</option>
                      <option value="eu-west-1" <%= typeof emailSettings !== 'undefined' && emailSettings.awsRegion === 'eu-west-1' ? 'selected' : '' %>>EU (Ireland)</option>
                      <option value="ap-southeast-1" <%= typeof emailSettings !== 'undefined' && emailSettings.awsRegion === 'ap-southeast-1' ? 'selected' : '' %>>Asia Pacific (Singapore)</option>
                    </select>
                  </div>
                </div>

                <div class="form-actions">
                  <button type="submit" class="btn btn-primary">
                    <span class="btn-icon">üíæ</span>
                    Update Email Settings
                  </button>
                  <button type="button" class="btn btn-secondary" onclick="testEmailConfiguration()">
                    <span class="btn-icon">üìß</span>
                    Send Test Email
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Notification Settings -->
        <div class="tab-pane fade" id="notifications" role="tabpanel">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">
                <span class="card-icon">üîî</span>
                Notification Settings
              </h3>
            </div>
            <div class="card-body">
              <form method="POST" action="/backoffice/settings/notifications" class="storehub-form">
                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                
                <h6 class="form-section-title">General Notifications</h6>
                <div class="form-check-group">
                  <label class="form-check">
                    <input type="checkbox" class="form-check-input" name="emailEnabled" id="emailEnabled" <%= typeof notificationSettings === 'undefined' || notificationSettings.emailEnabled !== false ? 'checked' : '' %>>
                    <span class="form-check-label">Enable email notifications</span>
                  </label>
                </div>

                <h6 class="form-section-title">Alert Types</h6>
                <div class="form-check-group">
                  <label class="form-check">
                    <input type="checkbox" class="form-check-input" name="newMerchantAlert" id="newMerchantAlert" <%= typeof notificationSettings === 'undefined' || notificationSettings.newMerchantAlert !== false ? 'checked' : '' %>>
                    <span class="form-check-label">New merchant registrations</span>
                  </label>
                  <label class="form-check">
                    <input type="checkbox" class="form-check-input" name="systemAlert" id="systemAlert" <%= typeof notificationSettings === 'undefined' || notificationSettings.systemAlert !== false ? 'checked' : '' %>>
                    <span class="form-check-label">System alerts and errors</span>
                  </label>
                  <label class="form-check">
                    <input type="checkbox" class="form-check-input" name="securityAlert" id="securityAlert" <%= typeof notificationSettings === 'undefined' || notificationSettings.securityAlert !== false ? 'checked' : '' %>>
                    <span class="form-check-label">Security alerts</span>
                  </label>
                </div>

                <h6 class="form-section-title">Reports</h6>
                <div class="form-check-group">
                  <label class="form-check">
                    <input type="checkbox" class="form-check-input" name="weeklyReport" id="weeklyReport" <%= typeof notificationSettings !== 'undefined' && notificationSettings.weeklyReport ? 'checked' : '' %>>
                    <span class="form-check-label">Weekly activity reports</span>
                  </label>
                  <label class="form-check">
                    <input type="checkbox" class="form-check-input" name="monthlyReport" id="monthlyReport" <%= typeof notificationSettings === 'undefined' || notificationSettings.monthlyReport !== false ? 'checked' : '' %>>
                    <span class="form-check-label">Monthly summary reports</span>
                  </label>
                </div>

                <button type="submit" class="btn btn-primary">
                  <span class="btn-icon">üíæ</span>
                  Update Notification Settings
                </button>
              </form>
            </div>
          </div>
        </div>

        <!-- System Statistics -->
        <div class="tab-pane fade" id="stats" role="tabpanel">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">
                <span class="card-icon">üìä</span>
                System Statistics
              </h3>
            </div>
            <div class="card-body">
              <div id="systemStatsContent">
                <div class="loading-state">
                  <div class="spinner"></div>
                  <p>Loading system statistics...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
/* StoreHub Settings Page Styles */
.settings-layout {
  display: grid;
  grid-template-columns: 260px 1fr;
  gap: 2rem;
  margin-top: 2rem;
}

.settings-nav .nav-pills {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.settings-nav .nav-link {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem 1rem;
  border: none;
  background: transparent;
  color: var(--sh-gray-700);
  border-radius: 8px;
  transition: all 0.2s ease;
  text-align: left;
}

.settings-nav .nav-link:hover {
  background: var(--sh-gray-100);
  color: var(--sh-gray-900);
}

.settings-nav .nav-link.active {
  background: var(--sh-primary-orange-light);
  color: var(--sh-primary-orange);
  font-weight: 500;
}

.settings-nav .nav-icon {
  font-size: 1.25rem;
}

.settings-nav .nav-title {
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--sh-gray-500);
  margin-bottom: 1rem;
  padding: 0 1rem;
}

.form-section-title {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--sh-gray-900);
  margin: 1.5rem 0 1rem;
}

.form-section-title .section-icon {
  font-size: 1rem;
}

.form-divider {
  height: 1px;
  background: var(--sh-gray-200);
  margin: 2rem 0;
}

.info-card {
  display: flex;
  gap: 1rem;
  padding: 1rem;
  background: var(--sh-gray-50);
  border: 1px solid var(--sh-gray-200);
  border-radius: 8px;
  margin: 1.5rem 0;
}

.info-card .info-icon {
  font-size: 1.5rem;
}

.info-card .info-content h6 {
  margin-bottom: 0.75rem;
  font-weight: 600;
  color: var(--sh-gray-900);
}

.info-card .info-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

.info-card .info-label {
  color: var(--sh-gray-600);
  font-size: 0.875rem;
}

.info-card .info-value {
  color: var(--sh-gray-900);
  font-weight: 500;
}

.form-check-group {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  margin: 1rem 0;
}

.form-check {
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
  cursor: pointer;
}

.form-check-input {
  width: 1.25rem;
  height: 1.25rem;
  margin-top: 0.125rem;
  border: 2px solid var(--sh-gray-300);
  border-radius: 4px;
  cursor: pointer;
}

.form-check-input:checked {
  background-color: var(--sh-primary-orange);
  border-color: var(--sh-primary-orange);
}

.form-check-label {
  flex: 1;
  color: var(--sh-gray-900);
  cursor: pointer;
}

.provider-settings {
  padding: 1rem;
  background: var(--sh-gray-50);
  border-radius: 8px;
  margin: 1rem 0;
}

.loading-state {
  text-align: center;
  padding: 3rem;
}

.spinner {
  width: 3rem;
  height: 3rem;
  border: 3px solid var(--sh-gray-200);
  border-top-color: var(--sh-primary-orange);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 1rem;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Responsive */
@media (max-width: 768px) {
  .settings-layout {
    grid-template-columns: 1fr;
  }
  
  .settings-nav {
    margin-bottom: 1rem;
  }
}
</style>

<script>
// Load system stats when tab is activated
document.addEventListener('DOMContentLoaded', function() {
  const statsTab = document.getElementById('stats-tab');
  if (statsTab) {
    statsTab.addEventListener('shown.bs.tab', function() {
      loadSystemStats();
    });
  }
});

async function loadSystemStats() {
  try {
    const response = await fetch('/backoffice/settings/api/stats');
    const stats = await response.json();
    
    const content = `
      <div class="stats-grid">
        <div class="stats-card">
          <div class="stats-icon">üè¢</div>
          <div class="stats-value">${stats.merchants?.total || 0}</div>
          <div class="stats-label">Total Merchants</div>
          <div class="stats-trend trend-positive">
            <span>${stats.merchants?.active || 0} active</span>
          </div>
        </div>
        <div class="stats-card">
          <div class="stats-icon">üë•</div>
          <div class="stats-value">${stats.users?.total || 0}</div>
          <div class="stats-label">Total Users</div>
          <div class="stats-trend trend-positive">
            <span>${stats.users?.active || 0} active</span>
          </div>
        </div>
        <div class="stats-card">
          <div class="stats-icon">üìã</div>
          <div class="stats-value">${stats.queues?.total || 0}</div>
          <div class="stats-label">Total Queues</div>
          <div class="stats-trend trend-neutral">
            <span>${stats.queues?.active || 0} active</span>
          </div>
        </div>
        <div class="stats-card">
          <div class="stats-icon">‚è±Ô∏è</div>
          <div class="stats-value">${Math.floor((stats.system?.uptime || 0) / 3600)}h</div>
          <div class="stats-label">Uptime</div>
          <div class="stats-trend trend-positive">
            <span>System running</span>
          </div>
        </div>
      </div>
      
      <div class="content-grid" style="margin-top: 2rem;">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">System Information</h3>
          </div>
          <div class="card-body">
            <table class="table">
              <tr>
                <td>Node Version:</td>
                <td><code>${stats.system?.nodeVersion || 'N/A'}</code></td>
              </tr>
              <tr>
                <td>Platform:</td>
                <td><code>${stats.system?.platform || 'N/A'}</code></td>
              </tr>
              <tr>
                <td>Environment:</td>
                <td><span class="badge ${stats.system?.env === 'production' ? 'badge-success' : 'badge-warning'}">${stats.system?.env || 'development'}</span></td>
              </tr>
              <tr>
                <td>Memory Usage:</td>
                <td>${Math.round((stats.system?.memoryUsage?.heapUsed || 0) / 1024 / 1024)} MB</td>
              </tr>
            </table>
          </div>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Quick Actions</h3>
          </div>
          <div class="card-body">
            <div class="btn-group-vertical">
              <button class="btn btn-secondary" onclick="refreshSystemStats()">
                <span class="btn-icon">üîÑ</span>
                Refresh Statistics
              </button>
              <a href="/backoffice/audit-logs" class="btn btn-secondary">
                <span class="btn-icon">üìã</span>
                View Audit Logs
              </a>
              <a href="/backoffice/merchants" class="btn btn-secondary">
                <span class="btn-icon">üè¢</span>
                Manage Merchants
              </a>
            </div>
          </div>
        </div>
      </div>
    `;
    
    document.getElementById('systemStatsContent').innerHTML = content;
  } catch (error) {
    console.error('Failed to load system stats:', error);
    document.getElementById('systemStatsContent').innerHTML = `
      <div class="alert alert-danger">
        Failed to load system statistics. Please try again.
      </div>
    `;
  }
}

function refreshSystemStats() {
  document.getElementById('systemStatsContent').innerHTML = `
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Refreshing system statistics...</p>
    </div>
  `;
  loadSystemStats();
}

// Email provider switching
const emailProvider = document.getElementById('emailProvider');
if (emailProvider) {
  emailProvider.addEventListener('change', function() {
    const provider = this.value;
    
    // Hide all provider settings
    document.querySelectorAll('.provider-settings').forEach(el => {
      el.style.display = 'none';
    });
    
    // Show selected provider settings
    if (provider === 'smtp') {
      document.getElementById('smtpSettings').style.display = '';
    } else if (provider === 'sendgrid') {
      document.getElementById('sendgridSettings').style.display = '';
    } else if (provider === 'ses') {
      document.getElementById('sesSettings').style.display = '';
    }
  });
}

// Test email configuration
async function testEmailConfiguration() {
  const testEmail = prompt('Enter email address to send test email to:');
  if (!testEmail) return;
  
  const btn = event.target;
  const originalText = btn.innerHTML;
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner-small"></span> Sending...';
  
  try {
    const response = await fetch('/backoffice/settings/email/test', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': '<%= csrfToken %>'
      },
      body: JSON.stringify({ testEmail })
    });
    
    const result = await response.json();
    
    if (response.ok) {
      alert('Test email sent successfully! Check your inbox.');
    } else {
      alert('Failed to send test email: ' + (result.error || 'Unknown error'));
    }
  } catch (error) {
    alert('Failed to send test email: ' + error.message);
  } finally {
    btn.disabled = false;
    btn.innerHTML = originalText;
  }
}
</script>