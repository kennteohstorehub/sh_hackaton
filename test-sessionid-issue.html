<!DOCTYPE html>
<html>
<head>
    <title>SessionID Debug Test</title>
</head>
<body>
    <h1>SessionID Debug Test</h1>
    <button onclick="clearAll()">Clear All Storage</button>
    <button onclick="checkStorage()">Check Storage</button>
    <button onclick="simulateJoin()">Simulate Join</button>
    <button onclick="simulateStatusCheck()">Simulate Status Check</button>
    
    <pre id="output"></pre>
    
    <script>
        function log(msg) {
            document.getElementById('output').innerText += msg + '\n';
        }
        
        function clearAll() {
            localStorage.clear();
            sessionStorage.clear();
            log('Cleared all storage');
            checkStorage();
        }
        
        function checkStorage() {
            log('\n=== Storage Check ===');
            log('localStorage.queueChatSessionId: ' + localStorage.getItem('queueChatSessionId'));
            log('localStorage.queueData: ' + localStorage.getItem('queueData'));
            log('sessionStorage.queueInfo: ' + sessionStorage.getItem('queueInfo'));
            
            const queueData = localStorage.getItem('queueData');
            if (queueData) {
                const parsed = JSON.parse(queueData);
                log('queueData.sessionId: ' + parsed.sessionId);
            }
        }
        
        function simulateJoin() {
            // Simulate what customer-queue.ejs does
            const sessionId = 'qc_' + Date.now() + '_test123';
            localStorage.setItem('queueChatSessionId', sessionId);
            
            const queueInfo = {
                sessionId: sessionId,
                verificationCode: 'TEST',
                position: 5
            };
            
            sessionStorage.setItem('queueJoined', 'true');
            sessionStorage.setItem('queueInfo', JSON.stringify(queueInfo));
            
            log('\nSimulated join with sessionId: ' + sessionId);
            checkStorage();
        }
        
        function simulateStatusCheck() {
            // Simulate what queue-chat.js does
            const storedId = localStorage.getItem('queueChatSessionId');
            log('\nStatus check would use sessionId: ' + storedId);
            
            // Check if queueData has different sessionId
            const queueData = localStorage.getItem('queueData');
            if (queueData) {
                const parsed = JSON.parse(queueData);
                if (parsed.sessionId && parsed.sessionId !== storedId) {
                    log('WARNING: queueData has different sessionId: ' + parsed.sessionId);
                }
            }
        }
        
        // Initial check
        checkStorage();
    </script>
</body>
</html>